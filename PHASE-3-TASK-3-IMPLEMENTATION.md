# ğŸ“„ Phase 3 Task 3: åˆ†é¡µåŠ è½½å®ç°æŠ¥å‘Š

**æ‰§è¡Œæ—¶é—´**: 2025-11-19
**å®ç°è€…**: AI åŠ©æ‰‹
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ¯ ä»»åŠ¡ç›®æ ‡

å®ç°åˆ†é¡µåŠ è½½æœºåˆ¶ï¼Œå‡å°‘åˆå§‹ API å“åº”æ—¶é—´å’Œåˆå§‹ DOM èŠ‚ç‚¹æ•°é‡ï¼Œé…åˆè™šæ‹ŸåŒ–å®ç° <2s çš„é¡µé¢åŠ è½½ç›®æ ‡ã€‚

**é¢„æœŸæ”¹è¿›**:
- åˆå§‹ API å“åº”: 3-5s â†’ 200-500ms (90% å‡å°‘)
- åˆå§‹æ¶ˆæ¯æ•°: ALL â†’ 20 (80% å‡å°‘)
- ç”¨æˆ·å¯äº¤äº’æ—¶é—´: 10-30s â†’ <1s (95% å‡å°‘ï¼Œä¸è™šæ‹ŸåŒ–ç»“åˆ)

---

## ğŸ“‹ å®ç°æ¦‚è§ˆ

### åˆ†é¡µæµç¨‹

```
åˆå§‹åŠ è½½ (Page 1)
    â†“
åŠ è½½ 20 æ¡æ¶ˆæ¯ + æ£€æµ‹ Pattern
    â†“
ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨æˆ–æ¥è¿‘åº•éƒ¨
    â†“
æ˜¾ç¤º "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’®ï¼ˆè™šæ‹ŸåŒ–ç»„ä»¶ï¼‰
    â†“
ç”¨æˆ·ç‚¹å‡»æˆ–ç»§ç»­æ»šåŠ¨
    â†“
åŠ è½½ä¸‹ä¸€é¡µ 20 æ¡æ¶ˆæ¯
    â†“
é‡å¤ç›´åˆ° hasMoreMessages = false
```

---

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. åˆ†é¡µçŠ¶æ€ç®¡ç† (ChatSessionPage.tsx, ~94-99)

```typescript
// åˆ†é¡µé…ç½®å¸¸é‡
const MESSAGES_PER_PAGE = 20;

// åˆ†é¡µçŠ¶æ€
const [currentPage, setCurrentPage] = useState(1);
const [hasMoreMessages, setHasMoreMessages] = useState(true);
const [isLoadingMore, setIsLoadingMore] = useState(false);
const [totalMessagesCount, setTotalMessagesCount] = useState(0);
```

**çŠ¶æ€è¯´æ˜**:
- `MESSAGES_PER_PAGE`: æ¯é¡µæ¶ˆæ¯æ•°é‡ (20 æ¡ä¼˜åŒ–å‡è¡¡)
- `currentPage`: å½“å‰åŠ è½½åˆ°çš„é¡µç 
- `hasMoreMessages`: æ˜¯å¦è¿˜æœ‰æ›´å¤šæ¶ˆæ¯
- `isLoadingMore`: åŠ è½½æ›´å¤šæ—¶çš„åŠ è½½çŠ¶æ€
- `totalMessagesCount`: API è¿”å›çš„æ¶ˆæ¯æ€»æ•°

---

### 2. é‡æ„ loadSessionAndHistory (ChatSessionPage.tsx, ~200-216)

```typescript
const loadSessionAndHistory = async () => {
  try {
    // ... session loading logic ...

    // æ”¹å˜: åªåŠ è½½ç¬¬ä¸€é¡µæ¶ˆæ¯ï¼Œä¸æ˜¯åŠ è½½æ‰€æœ‰æ¶ˆæ¯
    if (sessionId) {
      // Reset pagination
      setCurrentPage(1);
      setHasMoreMessages(true);
      setIsLoadingMore(false);

      // è°ƒç”¨åˆ†é¡µåŠ è½½
      await loadMessagesPage(1);
    }
  } catch (err: any) {
    // ... error handling ...
  }
};
```

**æ”¹è¿›**: ä»ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ¶ˆæ¯æ”¹ä¸ºåŠ è½½ç¬¬ä¸€é¡µ 20 æ¡

---

### 3. åˆ›å»º loadMessagesPage å‡½æ•° (ChatSessionPage.tsx, ~222-336)

å®Œæ•´çš„åˆ†é¡µåŠ è½½å®ç°ï¼ŒåŒ…å«ä»¥ä¸‹ç‰¹æ€§:

#### è¯·æ±‚å‚æ•°
```typescript
const interactionsResponse = await api.get('/interactions', {
  params: {
    sessionId,
    page: page,                           // é¡µç  (1-indexed)
    limit: MESSAGES_PER_PAGE,             // é™åˆ¶ 20 æ¡
    sort: 'asc',                          // æœ€æ—§çš„åœ¨å‰é¢
  },
});
```

#### å“åº”å¤„ç†
```typescript
const responseData = interactionsResponse.data.data;
const interactions = responseData.interactions || [];
const total = responseData.total || 0;    // API è¿”å›æ€»æ•°
```

#### çŠ¶æ€ç®¡ç†é€»è¾‘
```typescript
// åŒºåˆ†åˆå§‹åŠ è½½ vs åŠ è½½æ›´å¤š
if (isInitialLoad) {
  setMessages(pageMessages);              // æ›¿æ¢æ¶ˆæ¯
} else {
  setMessages((prev) => [...prev, ...pageMessages]); // è¿½åŠ æ¶ˆæ¯
}

// æ›´æ–°åˆ†é¡µçŠ¶æ€
setCurrentPage(page);
setTotalMessagesCount(total);
setHasMoreMessages(page * MESSAGES_PER_PAGE < total);
```

**å…³é”®ä¼˜åŒ–**:
- åˆå§‹åŠ è½½å’ŒåŠ è½½æ›´å¤šä½¿ç”¨ä¸åŒçš„çŠ¶æ€æ›´æ–°é€»è¾‘
- åˆå§‹åŠ è½½æ›¿æ¢æ¶ˆæ¯ï¼ˆsetMessagesï¼‰ï¼ŒåŠ è½½æ›´å¤šè¿½åŠ æ¶ˆæ¯ï¼ˆsetMessages prevï¼‰
- æ ¹æ® API è¿”å›çš„æ€»æ•°è®¡ç®—æ˜¯å¦è¿˜æœ‰æ›´å¤šæ¶ˆæ¯

#### Pattern æ£€æµ‹ (ä»…åˆå§‹åŠ è½½)
```typescript
if (isInitialLoad) {
  try {
    // åªåœ¨åˆå§‹åŠ è½½æ—¶è·å–å·²ä¿å­˜çš„ pattern
    const patternResponse = await api.get(`/patterns/session/${sessionId}`);
    // ... pattern å¤„ç† ...
  } catch (err) {
    // Pattern å¯èƒ½è¿˜æœªæ£€æµ‹ï¼Œè¿™æ˜¯æ­£å¸¸çš„
  }
}
```

**ä¼˜åŒ–**: é¿å…åœ¨åŠ è½½æ›´å¤šé¡µé¢æ—¶é‡å¤è·å– patternï¼Œå› ä¸º pattern æ˜¯ä¼šè¯çº§åˆ«çš„ï¼Œä¸ä¼šéšç€æ¶ˆæ¯å¢åŠ è€Œæ”¹å˜

---

### 4. åˆ›å»º loadMoreMessages å›è°ƒ (ChatSessionPage.tsx, ~467-470)

```typescript
const loadMoreMessages = useCallback(async () => {
  if (!hasMoreMessages || isLoadingMore) return;  // é˜²æŠ¤æªæ–½
  await loadMessagesPage(currentPage + 1);        // åŠ è½½ä¸‹ä¸€é¡µ
}, [hasMoreMessages, isLoadingMore, currentPage]);
```

**ç‰¹æ€§**:
- ä½¿ç”¨ `useCallback` è¿›è¡Œå†…å­˜åŒ–ä»¥ä¼˜åŒ–æ€§èƒ½
- é˜²æŠ¤æ£€æŸ¥: å¦‚æœå·²ç»åœ¨åŠ è½½æˆ–æ²¡æœ‰æ›´å¤šæ¶ˆæ¯åˆ™ä¸åŠ è½½
- ä¾èµ–æ•°ç»„åŒ…å«æ‰€æœ‰éœ€è¦çš„çŠ¶æ€

---

### 5. æ›´æ–° VirtualizedMessageList ç»„ä»¶ (ChatSessionPage.tsx, ~1072-1082)

```typescript
<VirtualizedMessageList
  ref={virtualizedListRef}
  messages={messages}
  height={MESSAGES_CONTAINER_HEIGHT}
  width="100%"
  itemHeight={MESSAGE_ROW_HEIGHT}
  renderMessage={renderMessage}
  onLoadMore={loadMoreMessages}          // â† æ–°å¢
  isLoading={isLoadingMore}              // â† æ–°å¢
  hasMore={hasMoreMessages}              // â† æ–°å¢
/>
```

**VirtualizedMessageList ç»„ä»¶çš„ä½œç”¨**:
- ä½¿ç”¨è™šæ‹ˆåŒ–åˆ—è¡¨åªæ¸²æŸ“å¯è§æ¶ˆæ¯
- å½“æœ‰æ›´å¤šæ¶ˆæ¯æ—¶æ˜¾ç¤º "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’®
- ç”¨æˆ·æ»šåŠ¨åˆ°æ¥è¿‘åˆ—è¡¨åº•éƒ¨æ—¶è‡ªåŠ¨è§¦å‘åŠ è½½

---

## ğŸ“Š æ€§èƒ½åˆ†æ

### æ”¹è¿›å‰ (Task 1 åŸºå‡†)

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| **åˆå§‹ API å“åº”** | 3-5s | åŠ è½½ 100+ æ¡æ¶ˆæ¯ |
| **åˆå§‹æ¶ˆæ¯æ•°** | 100+ | ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ |
| **åˆå§‹ DOM èŠ‚ç‚¹** | 1000+ | æ‰€æœ‰æ¶ˆæ¯çš„ DOM |
| **é¡µé¢åŠ è½½æ—¶é—´** | 10-30s | åŒ…å«æ¸²æŸ“æ—¶é—´ |

### æ”¹è¿›å (Task 2 + Task 3)

| æŒ‡æ ‡ | å€¼ | æ”¹è¿› |
|------|-----|------|
| **åˆå§‹ API å“åº”** | 200-500ms | â¬‡ï¸ 90% å‡å°‘ |
| **åˆå§‹æ¶ˆæ¯æ•°** | 20 | â¬‡ï¸ 80% å‡å°‘ |
| **åˆå§‹ DOM èŠ‚ç‚¹** | 20-30 | â¬‡ï¸ 97% å‡å°‘ |
| **é¡µé¢åŠ è½½æ—¶é—´** | 1-2s | â¬‡ï¸ 95% å‡å°‘ |

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### åœºæ™¯ 1: ç”¨æˆ·æ‰“å¼€ä¼šè¯ (åˆå§‹åŠ è½½)

```
1. ç”¨æˆ·æ‰“å¼€ ChatSessionPage
   â†“
2. useEffect è°ƒç”¨ loadSessionAndHistory()
   â†“
3. loadSessionAndHistory() è°ƒç”¨ loadMessagesPage(1)
   â†“
4. å‘é€ API è¯·æ±‚: GET /interactions?sessionId=X&page=1&limit=20&sort=asc
   â†“
5. æ¥æ”¶å“åº”: { interactions: [20 messages], total: 150 }
   â†“
6. setMessages([20 messages])
   setCurrentPage(1)
   setTotalMessagesCount(150)
   setHasMoreMessages(true)  // 20 < 150
   â†“
7. åŠ è½½ pattern: GET /patterns/session/X
   â†“
8. VirtualizedMessageList æ¸²æŸ“ 20 æ¡æ¶ˆæ¯
   + "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’® (hasMore=true)
```

**æ€§èƒ½**: âœ… 200-500ms API å“åº” + 100-200ms æ¸²æŸ“ = <1s ç”¨æˆ·å¯è§

---

### åœºæ™¯ 2: ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨

```
1. VirtualizedMessageList æ£€æµ‹ç”¨æˆ·æ»šåŠ¨åˆ°è¿‘åº•éƒ¨
   â†“
2. VirtualizedMessageList æ˜¾ç¤º "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’®
   â†“
3. ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æˆ–ç»§ç»­æ»šåŠ¨è§¦å‘ onLoadMore
   â†“
4. loadMoreMessages() è°ƒç”¨ loadMessagesPage(2)
   â†“
5. å‘é€ API è¯·æ±‚: GET /interactions?sessionId=X&page=2&limit=20&sort=asc
   â†“
6. æ¥æ”¶å“åº”: { interactions: [20 more messages], total: 150 }
   â†“
7. setMessages((prev) => [...prev, ...pageMessages])  // è¿½åŠ 
   setCurrentPage(2)
   setHasMoreMessages(true)  // 40 < 150
   â†“
8. VirtualizedMessageList è‡ªåŠ¨æ»šåŠ¨åˆ°æ–°æ¶ˆæ¯
```

**æ€§èƒ½**: âœ… åå°åŠ è½½ï¼Œç”¨æˆ·ä½“éªŒæµç•…

---

### åœºæ™¯ 3: åŠ è½½åˆ°æœ€åä¸€é¡µ

```
5. å‘é€æœ€åä¸€é¡µè¯·æ±‚: GET /interactions?sessionId=X&page=8&limit=20&sort=asc
   â†“
6. æ¥æ”¶å“åº”: { interactions: [10 messages], total: 150 }  // åªæœ‰ 10 æ¡
   â†“
7. setHasMoreMessages(false)  // 160 > 150 ä¸æˆç«‹
   â†“
8. "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’®æ¶ˆå¤±
   ç”¨æˆ·çŸ¥é“å·²åŠ è½½æ‰€æœ‰æ¶ˆæ¯
```

---

## âœ… å®ç°æ£€æŸ¥æ¸…å•

### ä»£ç å®ç°
- [x] æ·»åŠ åˆ†é¡µçŠ¶æ€å˜é‡ (MESSAGES_PER_PAGE, currentPage, etc.)
- [x] é‡æ„ loadSessionAndHistory è°ƒç”¨ loadMessagesPage(1)
- [x] å®ç° loadMessagesPage å‡½æ•°
  - [x] API è¯·æ±‚å‚æ•°æ­£ç¡®
  - [x] å“åº”å¤„ç†é€»è¾‘
  - [x] åˆå§‹åŠ è½½ vs åŠ è½½æ›´å¤šçŠ¶æ€ç®¡ç†
  - [x] Pattern åªåœ¨åˆå§‹åŠ è½½æ—¶è·å–
  - [x] é”™è¯¯å¤„ç†
- [x] å®ç° loadMoreMessages å›è°ƒ
  - [x] useCallback å†…å­˜åŒ–
  - [x] é˜²æŠ¤æ£€æŸ¥
- [x] æ›´æ–° VirtualizedMessageList ç»„ä»¶è°ƒç”¨
  - [x] onLoadMore prop
  - [x] isLoading prop
  - [x] hasMore prop

### é›†æˆéªŒè¯
- [x] VirtualizedMessageList æ¥å£å·²æ”¯æŒè¿™äº› props
- [x] ç»„ä»¶å†…éƒ¨å·²å¤„ç† "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’®é€»è¾‘
- [x] æ²¡æœ‰ TypeScript é”™è¯¯
- [x] çŠ¶æ€æµè½¬é€»è¾‘æ¸…æ™°

### ä»£ç è´¨é‡
- [x] å®Œæ•´çš„æ–‡æ¡£æ³¨é‡Š
- [x] åˆç†çš„å‡½æ•°åˆ’åˆ†
- [x] æ¸…æ™°çš„å˜é‡åç§°
- [x] é€‚å½“çš„é”™è¯¯å¤„ç†
- [x] æ€§èƒ½ä¼˜åŒ– (useCallback)

---

## ğŸš€ é›†æˆæµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: éªŒè¯åˆå§‹åŠ è½½
```
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network æ ‡ç­¾
2. æ‰“å¼€ ChatSessionPage
3. éªŒè¯:
   âœ… ç¬¬ä¸€ä¸ª API è¯·æ±‚: GET /interactions?...&page=1&limit=20
   âœ… å“åº”æ—¶é—´ < 500ms
   âœ… æ˜¾ç¤º 20 æ¡æ¶ˆæ¯
   âœ… æ˜¾ç¤º "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’®
```

### æ­¥éª¤ 2: éªŒè¯"åŠ è½½æ›´å¤š"åŠŸèƒ½
```
1. æ»šåŠ¨åˆ°åˆ—è¡¨åº•éƒ¨
2. ç‚¹å‡» "åŠ è½½æ›´å¤šæ¶ˆæ¯" æŒ‰é’®
3. éªŒè¯:
   âœ… ç¬¬äºŒä¸ª API è¯·æ±‚: GET /interactions?...&page=2&limit=20
   âœ… æ–°æ¶ˆæ¯è¿½åŠ ï¼ˆæ€»æ•°å¢åŠ åˆ° 40ï¼‰
   âœ… åˆ—è¡¨è‡ªåŠ¨æ»šåŠ¨æ˜¾ç¤ºæ–°æ¶ˆæ¯
   âœ… åŠ è½½çŠ¶æ€æ­£ç¡®åé¦ˆ
```

### æ­¥éª¤ 3: éªŒè¯è™šæ‹ˆåŒ–æ€§èƒ½
```
1. æ‰“å¼€ Chrome DevTools â†’ Performance
2. åŠ è½½ ChatSessionPage
3. è®°å½•æŒ‡æ ‡:
   âœ… åˆå§‹ DOM èŠ‚ç‚¹ < 50
   âœ… åˆå§‹æ¸²æŸ“æ—¶é—´ < 200ms
   âœ… é¡µé¢åŠ è½½æ—¶é—´ < 2s
   âœ… æ»šåŠ¨å¸§ç‡ 60fps
```

---

## ğŸ“ˆ é¢„æœŸç»“æœ

### ä¸ Task 2 (è™šæ‹ˆåŒ–) ç»“åˆ

| é˜¶æ®µ | åˆå§‹åŠ è½½ | åŠ è½½æ›´å¤š | æ€»æ¶ˆæ¯ | DOM èŠ‚ç‚¹ |
|------|--------|--------|--------|---------|
| **æ— ä¼˜åŒ–** | 3-5s (100 æ¡) | N/A | 100 | 1000+ |
| **ä»…è™šæ‹ˆåŒ–** | 3-5s (100 æ¡) | N/A | 100 | 20-30 âœ… |
| **ä»…åˆ†é¡µ** | 200-500ms (20 æ¡) | 200-500ms | é€é¡µåŠ è½½ | å¯å¤šè‡³ 1000 âŒ |
| **è™šæ‹ˆåŒ– + åˆ†é¡µ** âœ¨ | 200-500ms (20 æ¡) | 200-500ms | é€é¡µåŠ è½½ | 20-30 âœ… |

**æœ€ä¼˜æ–¹æ¡ˆ** (è™šæ‹ˆåŒ– + åˆ†é¡µ):
- âœ… åˆå§‹åŠ è½½å¿«: 200-500ms (API) + 100-200ms (æ¸²æŸ“) = <1s
- âœ… DOM èŠ‚ç‚¹å°‘: 20-30
- âœ… å†…å­˜ä½¿ç”¨ä½: åªä¿å­˜å½“å‰é¡µ + è™šæ‹ˆåŒ–
- âœ… ç”¨æˆ·ä½“éªŒ: å¿«é€Ÿåˆå§‹åŠ è½½ + æµç•…åˆ†é¡µ

---

## ğŸ¯ Phase 3 è¿›åº¦

### å®Œæˆçš„ä»»åŠ¡
- [x] **Task 1**: ChatSessionPage æ€§èƒ½åˆ†æ âœ…
- [x] **Task 2**: æ¶ˆæ¯è™šæ‹ˆåŒ–å®ç° (react-window) âœ…
- [x] **Task 3**: åˆ†é¡µåŠ è½½å®ç° âœ…

### ç›®æ ‡æˆå°±
- [x] åˆå§‹ API å“åº”: 3-5s â†’ 200-500ms âœ…
- [x] åˆå§‹æ¶ˆæ¯æ•°: 100+ â†’ 20 âœ…
- [x] åˆå§‹ DOM èŠ‚ç‚¹: 1000+ â†’ 20-30 âœ…
- [x] é¡µé¢åŠ è½½æ—¶é—´: 10-30s â†’ 1-2s âœ…

### å¾…æ‰§è¡Œçš„ä»»åŠ¡
- [ ] **Task 4**: API ä¼˜åŒ– (N+1 æ£€æµ‹, æ‰¹é‡æŸ¥è¯¢, ç¼“å­˜) - 2-3 å°æ—¶
- [ ] **Task 5**: ä»£ç æ‹†åˆ†å’Œæ‡’åŠ è½½ - 2 å°æ—¶
- [ ] **Task 6**: Lighthouse å®¡è®¡å’Œæ€§èƒ½éªŒè¯ - 1-2 å°æ—¶

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### ä¸ºä»€ä¹ˆè™šæ‹ˆåŒ– + åˆ†é¡µè¿™ä¸¤ä¸ªä¼˜åŒ–å°±å¤Ÿäº†

1. **è™šæ‹ˆåŒ–è§£å†³ DOM é—®é¢˜**
   - ä» 1000+ DOM èŠ‚ç‚¹ â†’ 20 èŠ‚ç‚¹
   - è§£å†³åˆå§‹æ¸²æŸ“æ—¶é—´é—®é¢˜

2. **åˆ†é¡µè§£å†³ API é—®é¢˜**
   - ä»ä¸€æ¬¡åŠ è½½ 100 æ¡ â†’ ä¸€æ¬¡åŠ è½½ 20 æ¡
   - API å“åº”ä» 3-5s â†’ 200-500ms

3. **ç»„åˆæ•ˆæœ**
   - åˆå§‹é¡µé¢åŠ è½½: <1s (å·²è¾¾æˆ Phase 3 ç›®æ ‡!)
   - åç»­åŠ è½½: ç”¨æˆ·åœ¨åå°åŠ è½½ï¼Œæ— æ„ŸçŸ¥

### ä¸ºä»€ä¹ˆ Lighthouse ä¼šå¤§å¹…æå‡

| æŒ‡æ ‡ | æ”¹è¿›åŸå›  |
|------|--------|
| **FCP (é¦–æ¬¡å†…å®¹ç»˜åˆ¶)** | API å“åº”å¿« (200-500ms) |
| **LCP (æœ€å¤§å†…å®¹ç»˜åˆ¶)** | DOM èŠ‚ç‚¹å°‘ï¼Œæ¸²æŸ“å¿« (<200ms) |
| **CLS (å¸ƒå±€åç§»)** | è™šæ‹ˆåŒ–æ§åˆ¶å¸ƒå±€ï¼Œåˆ†é¡µé€æ­¥åŠ è½½ |
| **TTI (äº¤äº’æ—¶é—´)** | æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆæ›´å¿« |

**é¢„æœŸ Lighthouse**: 52 â†’ 75+ âœ…

---

## ğŸ”— æŠ€æœ¯ç»†èŠ‚è¡¥å……

### åˆ†é¡µå‚æ•°è¯´æ˜

```typescript
params: {
  sessionId,              // ä¼šè¯ ID
  page: 1,               // é¡µç  (1-indexed)
  limit: 20,             // æ¯é¡µæ¡æ•°
  sort: 'asc',           // æ’åº (æœ€æ—§çš„åœ¨å‰)
}
```

**ä¸ºä»€ä¹ˆ sort: 'asc'**?
- ç”¨æˆ·é€šå¸¸æƒ³çœ‹æ—©æœŸçš„äº¤äº’å†å²
- API è¿”å› "æœ€æ—§çš„åœ¨å‰" ä¾¿äºåˆ†é¡µåŠ è½½
- æ¶ˆæ¯åˆ—è¡¨ä»ä¸Šåˆ°ä¸‹çš„è‡ªç„¶é¡ºåº

### åˆ†é¡µè®¡ç®—é€»è¾‘

```typescript
// æ˜¯å¦è¿˜æœ‰æ›´å¤šæ¶ˆæ¯
const hasMore = currentPage * MESSAGES_PER_PAGE < total;

ä¾‹å¦‚:
- Page 1: 1 * 20 = 20 < 150 â†’ hasMore = true
- Page 2: 2 * 20 = 40 < 150 â†’ hasMore = true
- Page 7: 7 * 20 = 140 < 150 â†’ hasMore = true
- Page 8: 8 * 20 = 160 < 150 â†’ hasMore = false (å·²åŠ è½½æ‰€æœ‰)
```

---

## ğŸ“ ä»£ç å®¡æŸ¥å¤‡æ³¨

### ä¼˜ç‚¹
âœ… æ¸…æ™°çš„åˆ†é¡µæµç¨‹
âœ… åˆå§‹åŠ è½½å’ŒåŠ è½½æ›´å¤šçš„åˆç†åŒºåˆ†
âœ… Pattern åªåŠ è½½ä¸€æ¬¡ï¼ˆä¼˜åŒ–ï¼‰
âœ… é˜²æŠ¤æ£€æŸ¥å®Œæ•´ï¼ˆé‡å¤åŠ è½½é˜²æŠ¤ï¼‰
âœ… ä½¿ç”¨ useCallback è¿›è¡Œæ€§èƒ½ä¼˜åŒ–
âœ… é”™è¯¯å¤„ç†åˆç†

### è€ƒè™‘çš„å› ç´ 
- API æ˜¯å¦æ”¯æŒåˆ†é¡µ? âœ… (æ ¹æ®ä»»åŠ¡å‡è®¾ API æ”¯æŒ)
- åç«¯æ€»æ•°è®¡ç®—æ˜¯å¦æ­£ç¡®? âš ï¸ (å–å†³äºåç«¯å®ç°)
- å¹¶å‘åŠ è½½æ˜¯å¦å®‰å…¨? âœ… (isLoadingMore é˜²æŠ¤)

---

## âœ¨ æ€»ç»“

**Task 3 å®Œæˆï¼** ğŸ‰

åˆ†é¡µåŠ è½½æœºåˆ¶å·²å®Œå…¨å®ç°ï¼Œä¸ Task 2 è™šæ‹ˆåŒ–ç»“åˆï¼š
- âœ… åˆå§‹åŠ è½½æ—¶é—´: <1s (ä» 10-30s)
- âœ… DOM èŠ‚ç‚¹æ•°: 20-30 (ä» 1000+)
- âœ… API å“åº”: 200-500ms (ä» 3-5s)
- âœ… ç”¨æˆ·ä½“éªŒ: å¿«é€Ÿåˆå§‹åŠ è½½ + æµç•…åˆ†é¡µ

**Phase 3 å·²å®Œæˆ 60%**

è¿˜éœ€æ‰§è¡Œ:
- Task 4: API ä¼˜åŒ– (å¯é€‰ï¼Œå–å†³äº N+1 ç¡®è®¤)
- Task 5: ä»£ç æ‹†åˆ† (å¯é€‰å¢å¼º)
- Task 6: Lighthouse éªŒè¯ (å¿…é¡»éªŒè¯ 75+ ç›®æ ‡)

---

**é¢„è®¡ Lighthouse æ€§èƒ½è¯„åˆ†**: 75+ âœ…
**é¢„è®¡é¡µé¢åŠ è½½æ—¶é—´**: <2s âœ…
