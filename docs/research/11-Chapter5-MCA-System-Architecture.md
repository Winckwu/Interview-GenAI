# ç¬¬5ç« è¡¥å……ï¼šMCAç³»ç»Ÿæ¶æ„è®¾è®¡
# Chapter 5 Supplement: MCA System Architecture Design

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**å¯¹åº”ç« èŠ‚**: ç¬¬5ç«  - ç³»ç»Ÿè®¾è®¡ä¸è¯„ä¼°
**æœ€åæ›´æ–°**: 2025-11-29

---

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#3-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
4. [19é¡¹MRå·¥å…·è§„æ ¼](#4-19é¡¹mrå·¥å…·è§„æ ¼)
5. [ç”¨æˆ·ç•Œé¢è®¾è®¡](#5-ç”¨æˆ·ç•Œé¢è®¾è®¡)
6. [æ•°æ®æµä¸è§¦å‘æµç¨‹](#6-æ•°æ®æµä¸è§¦å‘æµç¨‹)
7. [æŠ€æœ¯å®ç°ç»†èŠ‚](#7-æŠ€æœ¯å®ç°ç»†èŠ‚)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä½

**MCA (Metacognitive Companion for AI-Assisted Learning)**

> ä¸€ä¸ªåµŒå…¥å¼å…ƒè®¤çŸ¥æ”¯æŒç³»ç»Ÿï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·åœ¨ä½¿ç”¨ç”Ÿæˆå¼AIå·¥å…·æ—¶å‘å±•å’Œç»´æŠ¤å…ƒè®¤çŸ¥èƒ½åŠ›ï¼Œé¢„é˜²è¿‡åº¦ä¾èµ–å’ŒæŠ€èƒ½é€€åŒ–ã€‚

### 1.2 è®¾è®¡ç›®æ ‡

| ç›®æ ‡ | æè¿° | æˆåŠŸæŒ‡æ ‡ |
|------|------|---------|
| **G1: æ¨¡å¼è¯†åˆ«** | å®æ—¶è¯†åˆ«ç”¨æˆ·å…ƒè®¤çŸ¥ä½¿ç”¨æ¨¡å¼ | å‡†ç¡®ç‡>80% |
| **G2: æ™ºèƒ½å¹²é¢„** | æ ¹æ®æ¨¡å¼å·®å¼‚åŒ–æä¾›æ”¯æŒ | æ°å½“æ€§>4.0/5.0 |
| **G3: èƒ½åŠ›åŸ¹å…»** | ä¿ƒè¿›ç”¨æˆ·å…ƒè®¤çŸ¥èƒ½åŠ›å‘å±• | æ¨¡å¼Fâ†’éFè½¬åŒ–ç‡>50% |
| **G4: é£é™©é¢„é˜²** | é¢„é˜²è¿‡åº¦ä¾èµ–å’ŒæŠ€èƒ½é€€åŒ– | é€€åŒ–è­¦å‘Šè¦†ç›–ç‡>90% |
| **G5: ç”¨æˆ·ä½“éªŒ** | éä¾µå…¥å¼ã€å¯å¿«é€Ÿå…³é—­ | SUS>68 |

### 1.3 è®¾è®¡åŸåˆ™å›é¡¾

| åŸåˆ™ | æ ¸å¿ƒç†å¿µ | ç³»ç»Ÿä½“ç° |
|------|---------|---------|
| DP1 å­¦ä¹ ä¼˜å…ˆ | ä¼˜å…ˆåŸ¹å…»èƒ½åŠ› | MRå·¥å…·ä¾§é‡å¼•å¯¼è€Œéæ›¿ä»£ |
| DP2 è‡ªé€‚åº”è„šæ‰‹æ¶ | å·®å¼‚åŒ–æ”¯æŒ | Pattern-basedå¹²é¢„ç­–ç•¥ |
| DP3 æ¸è¿›å¼å¹²é¢„ | Softâ†’Mediumâ†’Hard | ä¸‰å±‚å¹²é¢„å¼ºåº¦è®¾è®¡ |
| DP4 é€æ˜æ€§ | ç”¨æˆ·ç†è§£å¹²é¢„åŸå›  | å¹²é¢„è¯´æ˜å’Œè¯æ®å±•ç¤º |
| DP5 å…ƒè®¤çŸ¥åŸ¹å…» | ç‹¬ç«‹æ€è€ƒèƒ½åŠ› | Transfer Testè®¾è®¡ |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 é«˜å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MCA System Architecture                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Presentation Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Web Client  â”‚  â”‚Browser Pluginâ”‚  â”‚  Mobile App  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ REST API / WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway Layer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Authentication â”‚ Rate Limiting â”‚ Load Balancing â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application Layer                               â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Pattern   â”‚  â”‚ Interventionâ”‚  â”‚   Session   â”‚  â”‚   User      â”‚ â”‚
â”‚  â”‚ Recognition â”‚  â”‚   Engine    â”‚  â”‚  Manager    â”‚  â”‚  Profile    â”‚ â”‚
â”‚  â”‚   Module    â”‚  â”‚             â”‚  â”‚             â”‚  â”‚  Manager    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                â”‚                â”‚                â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                   â”‚                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚    Core Service Bus         â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Data Layer                                    â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  User DB    â”‚  â”‚ Session DB  â”‚  â”‚Intervention â”‚  â”‚  Analytics  â”‚  â”‚
â”‚  â”‚ (PostgreSQL)â”‚  â”‚  (Redis)    â”‚  â”‚  Log DB     â”‚  â”‚    DB       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ML/AI Layer                                      â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  SVM Classifier â”‚  â”‚  LLM Service    â”‚  â”‚  Feature        â”‚       â”‚
â”‚  â”‚  (Pattern)      â”‚  â”‚  (Semantic)     â”‚  â”‚  Extraction     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—èŒè´£

| æ¨¡å— | èŒè´£ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| **Pattern Recognition** | å®æ—¶è¯†åˆ«ç”¨æˆ·å…ƒè®¤çŸ¥æ¨¡å¼ | Python, SVM, LLM |
| **Intervention Engine** | å†³ç­–å’Œè§¦å‘MRå·¥å…· | Python, Rule Engine |
| **Session Manager** | ç®¡ç†ç”¨æˆ·ä¼šè¯å’ŒçŠ¶æ€ | Redis, WebSocket |
| **User Profile Manager** | ç»´æŠ¤ç”¨æˆ·ç”»åƒå’ŒåŸºçº¿ | PostgreSQL, ORM |
| **ML Service** | æä¾›æ¨¡å¼åˆ†ç±»é¢„æµ‹ | scikit-learn, FastAPI |
| **LLM Service** | æä¾›è¯­ä¹‰åˆ†æèƒ½åŠ› | OpenAI API, Prompt Engineering |

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 Pattern Recognition Module

**åŠŸèƒ½**: å®æ—¶è¯†åˆ«ç”¨æˆ·å½“å‰çš„å…ƒè®¤çŸ¥ä½¿ç”¨æ¨¡å¼

```python
class PatternRecognitionModule:
    """æ¨¡å¼è¯†åˆ«æ¨¡å—"""

    def __init__(self):
        self.svm_model = load_model('svm_pattern_classifier.pkl')
        self.llm_service = LLMService()
        self.feature_extractor = FeatureExtractor()

    def recognize_pattern(self, session: Session) -> PatternResult:
        """è¯†åˆ«å½“å‰ä¼šè¯çš„ç”¨æˆ·æ¨¡å¼"""

        # Step 1: æå–è¡Œä¸ºç‰¹å¾
        behavioral_features = self.feature_extractor.extract_behavioral(
            session.interactions
        )

        # Step 2: æå–è¯­ä¹‰ç‰¹å¾ (LLMåˆ†æ)
        semantic_features = self.llm_service.analyze_metacognition(
            session.prompts[-5:]  # æœ€è¿‘5æ¡æç¤º
        )

        # Step 3: åˆå¹¶ç‰¹å¾å‘é‡
        feature_vector = self._merge_features(
            behavioral_features,
            semantic_features
        )

        # Step 4: SVMé¢„æµ‹
        pattern = self.svm_model.predict([feature_vector])[0]
        confidence = self.svm_model.predict_proba([feature_vector]).max()

        # Step 5: è®¡ç®—12ç»´è¯„åˆ†
        subprocess_scores = self._calculate_subprocess_scores(
            feature_vector
        )

        return PatternResult(
            pattern=pattern,
            confidence=confidence,
            subprocess_scores=subprocess_scores,
            timestamp=datetime.now()
        )

    def _calculate_subprocess_scores(self, features) -> Dict[str, int]:
        """è®¡ç®—12ç»´å­è¿‡ç¨‹è¯„åˆ† (0-3)"""
        return {
            'P1': self._score_dimension(features, 'task_decomposition'),
            'P2': self._score_dimension(features, 'goal_setting'),
            'P3': self._score_dimension(features, 'strategy_selection'),
            'P4': self._score_dimension(features, 'role_definition'),
            'M1': self._score_dimension(features, 'progress_tracking'),
            'M2': self._score_dimension(features, 'quality_checking'),
            'M3': self._score_dimension(features, 'trust_calibration'),
            'E1': self._score_dimension(features, 'output_evaluation'),
            'E2': self._score_dimension(features, 'risk_assessment'),
            'E3': self._score_dimension(features, 'capability_judgment'),
            'R1': self._score_dimension(features, 'strategy_adjustment'),
            'R2': self._score_dimension(features, 'tool_switching'),
        }
```

### 3.2 Intervention Engine

**åŠŸèƒ½**: å†³ç­–ä½•æ—¶è§¦å‘å“ªä¸ªMRå·¥å…·ï¼Œä»¥ä»€ä¹ˆå¼ºåº¦

```python
class InterventionEngine:
    """å¹²é¢„å†³ç­–å¼•æ“"""

    def __init__(self):
        self.trigger_rules = load_trigger_rules()
        self.fatigue_manager = InterventionFatigueManager()
        self.priority_calculator = PriorityCalculator()

    def decide_interventions(
        self,
        user: User,
        session: Session,
        pattern_result: PatternResult
    ) -> List[Intervention]:
        """å†³ç­–åº”è¯¥è§¦å‘çš„å¹²é¢„"""

        interventions = []

        # Step 1: æ£€æŸ¥æ‰€æœ‰MRå·¥å…·çš„è§¦å‘æ¡ä»¶
        for mr_tool in MR_TOOLS:
            if self._check_trigger_condition(mr_tool, user, session, pattern_result):

                # Step 2: è®¡ç®—ä¼˜å…ˆçº§
                priority = self.priority_calculator.calculate(
                    mr_tool=mr_tool,
                    user=user,
                    pattern=pattern_result.pattern,
                    subprocess_scores=pattern_result.subprocess_scores
                )

                # Step 3: æ£€æŸ¥ç–²åŠ³æ§åˆ¶
                if self.fatigue_manager.is_in_cooldown(user.id, mr_tool):
                    continue

                # Step 4: å®‰å…¨ä¼˜å…ˆè¦†ç›–
                if mr_tool in SAFETY_CRITICAL_MRS:
                    priority = 90  # å¼ºåˆ¶æœ€é«˜ä¼˜å…ˆçº§

                # Step 5: é€‰æ‹©å¹²é¢„å¼ºåº¦
                intensity = self._select_intensity(
                    user, session.task_risk, mr_tool
                )

                interventions.append(Intervention(
                    mr_tool=mr_tool,
                    priority=priority,
                    intensity=intensity,
                    reason=self._generate_reason(mr_tool, pattern_result)
                ))

        # Step 6: æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå–Top-N
        interventions.sort(key=lambda x: x.priority, reverse=True)
        return interventions[:3]  # æ¯æ¬¡æœ€å¤š3ä¸ªå¹²é¢„

    def _check_trigger_condition(self, mr_tool, user, session, pattern_result):
        """æ£€æŸ¥è§¦å‘æ¡ä»¶"""
        rule = self.trigger_rules[mr_tool]
        return rule.evaluate(user, session, pattern_result)

    def _select_intensity(self, user, risk_level, mr_tool):
        """é€‰æ‹©å¹²é¢„å¼ºåº¦"""
        if mr_tool in SAFETY_CRITICAL_MRS and risk_level == 'high':
            return 'MODAL'
        if user.total_score >= 30 and risk_level == 'low':
            return 'SILENT'
        if user.total_score >= 25 and risk_level == 'medium':
            return 'TOOLTIP'
        if user.pattern == 'F':
            return 'NOTIFICATION'
        return 'NOTIFICATION'
```

### 3.3 Session Manager

**åŠŸèƒ½**: ç®¡ç†ç”¨æˆ·ä¼šè¯çŠ¶æ€ï¼Œè¿½è¸ªå®æ—¶è¡Œä¸º

```python
class SessionManager:
    """ä¼šè¯ç®¡ç†å™¨"""

    def __init__(self):
        self.redis_client = Redis()
        self.active_sessions = {}

    def create_session(self, user_id: str) -> Session:
        """åˆ›å»ºæ–°ä¼šè¯"""
        session = Session(
            id=generate_session_id(),
            user_id=user_id,
            start_time=datetime.now(),
            interactions=[],
            current_pattern=None,
            fatigue_score=0
        )
        self.active_sessions[session.id] = session
        self._persist_to_redis(session)
        return session

    def record_interaction(self, session_id: str, interaction: Interaction):
        """è®°å½•ç”¨æˆ·äº¤äº’"""
        session = self.active_sessions[session_id]
        session.interactions.append(interaction)

        # æ›´æ–°å®æ—¶æŒ‡æ ‡
        session.update_metrics({
            'total_interactions': len(session.interactions),
            'verification_count': self._count_verifications(session),
            'consecutive_unverified': self._count_consecutive_unverified(session),
            'session_duration': (datetime.now() - session.start_time).minutes
        })

        # æ£€æµ‹æ¨¡å¼é€€åŒ–
        if self._detect_degradation(session):
            session.degradation_detected = True

        self._persist_to_redis(session)

    def get_session_metrics(self, session_id: str) -> Dict:
        """è·å–ä¼šè¯æŒ‡æ ‡"""
        session = self.active_sessions[session_id]
        return {
            'duration_minutes': session.duration_minutes,
            'interaction_count': len(session.interactions),
            'verification_rate': session.verification_count / max(len(session.interactions), 1),
            'refinement_rate': session.refinement_count / max(len(session.interactions), 1),
            'consecutive_unverified': session.consecutive_unverified,
            'current_pattern': session.current_pattern,
            'fatigue_score': session.fatigue_score
        }
```

---

## 4. 19é¡¹MRå·¥å…·è§„æ ¼

### 4.1 MRå·¥å…·å®Œæ•´è§„æ ¼è¡¨

| MR ID | åç§° | è§¦å‘æ¡ä»¶ | å¹²é¢„å½¢å¼ | å¼ºåº¦ | ç›®æ ‡æ¨¡å¼ |
|-------|------|---------|---------|------|---------|
| **ç±»åˆ«1: è§„åˆ’æ”¯æŒ** ||||||
| MR1 | ä»»åŠ¡åˆ†è§£è„šæ‰‹æ¶ | P1<2 && å¤æ‚ä»»åŠ¡ | äº¤äº’å¼åˆ†è§£å¼•å¯¼ | M | B/C/F |
| MR2 | è¿‡ç¨‹é€æ˜æ€§ | ä»»åŠ¡å¼€å§‹ | è¿›åº¦è¿½è¸ªé¢æ¿ | S | å…¨éƒ¨ |
| MR3 | äººç±»èƒ½åŠ¨æ€§ä¿æŠ¤ | P4<2 && é«˜ä¾èµ– | è¾¹ç•Œè®¾å®šæç¤º | M | C/F |
| MR4 | è§’è‰²å®šä¹‰æŒ‡å¯¼ | é¦–æ¬¡ä½¿ç”¨/æ–°ä»»åŠ¡ç±»å‹ | è§’è‰²è®¾å®šå‘å¯¼ | S | B/C |
| **ç±»åˆ«2: è¿­ä»£å­¦ä¹ æ”¯æŒ** ||||||
| MR5 | ä½æˆæœ¬è¿­ä»£ | refinement_count>0 | è¿­ä»£ä¼˜åŒ–å»ºè®® | S | B |
| MR6 | è·¨æ¨¡å‹å®éªŒ | R2<2 && éªŒè¯éœ€æ±‚ | å¤šæ¨¡å‹å¯¹æ¯”å·¥å…· | M | A/D |
| MR7 | å¤±è´¥å®¹å¿æœºåˆ¶ | è¿ç»­å¤±è´¥â‰¥2 | é¼“åŠ±å’Œæ›¿ä»£å»ºè®® | S | B/C |
| **ç±»åˆ«3: æƒ…å¢ƒæ•æ„Ÿé€‚åº”** ||||||
| MR8 | ä»»åŠ¡ç‰¹å¾è¯†åˆ« | æ–°ä»»åŠ¡ç±»å‹ | ä»»åŠ¡åˆ†ç±»æç¤º | S | C |
| MR9 | åŠ¨æ€ä¿¡ä»»æ ¡å‡† | trust_change>15% | ä¿¡ä»»åæ€æç¤º | M | C/D |
| MR10 | æˆæœ¬æ•ˆç›Šå†³ç­– | é«˜é£é™©ä»»åŠ¡ | é£é™©æ”¶ç›Šåˆ†æ | M | C/F |
| **ç±»åˆ«4: æ‰¹åˆ¤æ€§æ€ç»´å¢å¼º** ||||||
| MR11 | é›†æˆéªŒè¯å·¥å…· | M2<2 && unverifiedâ‰¥2 | éªŒè¯æ£€æŸ¥æ¸…å• | M | A/D |
| MR12 | æ‰¹åˆ¤æ€§æ€ç»´è„šæ‰‹æ¶ | E1<2 | è´¨ç–‘å¼•å¯¼é—®é¢˜ | M | B/C/F |
| **MR13** | **é€æ˜ä¸ç¡®å®šæ€§** | AIç½®ä¿¡åº¦<50% | ä¸ç¡®å®šæ€§æ ‡æ³¨ | **H** | **å…¨éƒ¨** |
| **ç±»åˆ«5: å…ƒè®¤çŸ¥å‘å±•** ||||||
| MR14 | å¼•å¯¼åæ€ | ä»»åŠ¡å®Œæˆ | åæ€é—®é¢˜æ¸…å• | S | B/E |
| MR15 | å…ƒè®¤çŸ¥ç­–ç•¥æŒ‡å¯¼ | P3<2 | ç­–ç•¥æ¨è | M | C/F |
| **MR16** | **æŠ€èƒ½é€€åŒ–é¢„é˜²** | é€€åŒ–é£é™©æ£€æµ‹ | é€€åŒ–è­¦å‘Š | **H** | **F** |
| MR17 | å­¦ä¹ å¯è§†åŒ– | å‘¨æœŸæ€§ | å­¦ä¹ è¿›åº¦æŠ¥å‘Š | S | B/E |
| **MR18** | **è¿‡åº¦ä¾èµ–è­¦å‘Š** | unverifiedâ‰¥4 && M2<2 | ä¾èµ–è­¦å‘Š | **H** | **F** |
| MR19 | å…ƒè®¤çŸ¥èƒ½åŠ›è¯Šæ–­ | é¦–æ¬¡/æœˆåº¦ | 12ç»´è¯„ä¼°æŠ¥å‘Š | S | å…¨éƒ¨ |

**å¼ºåº¦è¯´æ˜:** S=Soft(å¯å¿½ç•¥), M=Medium(å»ºè®®), H=Hard(å¼ºåˆ¶ç¡®è®¤)

### 4.2 å…³é”®MRå·¥å…·è¯¦ç»†è®¾è®¡

#### MR11: é›†æˆéªŒè¯å·¥å…·

```yaml
MR11:
  name: "é›†æˆéªŒè¯å·¥å…·"
  description: "å¸®åŠ©ç”¨æˆ·ç³»ç»ŸåŒ–éªŒè¯AIè¾“å‡ºçš„å·¥å…·"

  trigger_conditions:
    - M2 < 2  # è´¨é‡æ£€æŸ¥å¾—åˆ†ä½
    - consecutive_unverified >= 2  # è¿ç»­2æ¬¡æœªéªŒè¯
    - task_criticality in ['medium', 'high']  # ä¸­é«˜é£é™©ä»»åŠ¡

  intervention_content:
    type: "checklist"
    title: "AIè¾“å‡ºéªŒè¯æ¸…å•"
    items:
      - "[ ] æˆ‘ç†è§£äº†AIçš„å›ç­”å—ï¼Ÿ"
      - "[ ] è¿™ä¸ªå›ç­”æ˜¯å¦å®Œæ•´ï¼Ÿ"
      - "[ ] æœ‰æ²¡æœ‰æ˜æ˜¾çš„é”™è¯¯æˆ–é—æ¼ï¼Ÿ"
      - "[ ] æˆ‘èƒ½ç”¨å…¶ä»–æ¥æºéªŒè¯å…³é”®ä¿¡æ¯å—ï¼Ÿ"
      - "[ ] è¿™ä¸ªå›ç­”é€‚åˆæˆ‘çš„å…·ä½“æƒ…å†µå—ï¼Ÿ"
    actions:
      - label: "æˆ‘å·²éªŒè¯"
        action: "mark_verified"
      - label: "ç¨åéªŒè¯"
        action: "remind_later"
      - label: "éœ€è¦å¸®åŠ©"
        action: "show_verification_guide"

  priority_adjustment:
    base: 70
    pattern_modifier:
      A: -30  # æŠ‘åˆ¶
      D: -30  # æŠ‘åˆ¶
      F: +20  # æå‡
    subprocess_modifier:
      M2_0: +30
      M2_1: +20
      M2_2: +10
      M2_3: 0

  intensity: "NOTIFICATION"
  dismissible: true
  cooldown_minutes: 15
```

#### MR18: è¿‡åº¦ä¾èµ–è­¦å‘Š

```yaml
MR18:
  name: "è¿‡åº¦ä¾èµ–è­¦å‘Š"
  description: "æ£€æµ‹å¹¶è­¦å‘Šç”¨æˆ·å¯èƒ½çš„è¿‡åº¦ä¾èµ–è¡Œä¸º"

  trigger_conditions:
    - consecutive_unverified >= 4
    - M2 < 2
    - NOT in_cooldown

  safety_override: true  # ç»•è¿‡ç–²åŠ³æ§åˆ¶

  intervention_content:
    type: "modal"
    severity: "warning"
    title: "âš ï¸ è¿‡åº¦ä¾èµ–æ£€æµ‹"
    message: |
      æ£€æµ‹åˆ°æ‚¨è¿ç»­{consecutive_unverified}æ¬¡äº¤äº’æœªè¿›è¡ŒéªŒè¯ã€‚

      **æ½œåœ¨é£é™©:**
      - å¯èƒ½æ¥å—äº†ä¸æ­£ç¡®çš„ä¿¡æ¯
      - ç‹¬ç«‹æ€è€ƒèƒ½åŠ›å¯èƒ½å—å½±å“
      - å­¦ä¹ æ•ˆæœå¯èƒ½é™ä½

      **å»ºè®®è¡ŒåŠ¨:**
      1. æš‚åœå½“å‰ä»»åŠ¡ï¼Œå›é¡¾æœ€è¿‘çš„AIè¾“å‡º
      2. å°è¯•ç‹¬ç«‹æ€è€ƒåå†å‚è€ƒAIå»ºè®®
      3. å¯¹å…³é”®ä¿¡æ¯è¿›è¡Œäº¤å‰éªŒè¯
    actions:
      - label: "æš‚åœå¹¶åæ€"
        action: "pause_and_reflect"
        primary: true
      - label: "æˆ‘ç†è§£é£é™©ï¼Œç»§ç»­"
        action: "acknowledge_and_continue"
        requires_confirmation: true
      - label: "äº†è§£æ›´å¤š"
        action: "show_overreliance_guide"

  priority: 90  # å›ºå®šé«˜ä¼˜å…ˆçº§
  intensity: "MODAL"
  dismissible: false  # éœ€ç¡®è®¤
  log_to_audit: true
```

---

## 5. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 5.1 ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCA - Metacognitive Companion                    [Settings] [Help]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                 â”‚  â”‚   Metacognitive Panel    â”‚  â”‚
â”‚  â”‚                                 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                 â”‚  â”‚  Current Pattern: C      â”‚  â”‚
â”‚  â”‚        AI Chat Interface        â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 68%          â”‚  â”‚
â”‚  â”‚                                 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚     (Integrated with ChatGPT    â”‚  â”‚  Session Stats:          â”‚  â”‚
â”‚  â”‚      or other AI tools)         â”‚  â”‚  â€¢ Duration: 45 min      â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚  â€¢ Interactions: 12      â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚  â€¢ Verifications: 3      â”‚  â”‚
â”‚  â”‚                                 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                 â”‚  â”‚  ğŸ’¡ Suggestion:          â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚  Consider verifying the  â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚  last AI response.       â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚  [Verify] [Dismiss]      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  12-Dimension Radar  â”‚  Learning Progress  â”‚  Intervention Log  â”‚â”‚
â”‚  â”‚  [Chart]             â”‚  [Timeline]         â”‚  [History]         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å¹²é¢„å±•ç¤ºå½¢å¼

**Level 0: Silent (æ— å¹²é¢„)**
- ä¸æ˜¾ç¤ºä»»ä½•UIå…ƒç´ 
- ä»…åå°è®°å½•

**Level 1: Tooltip (éæ¨¡æ€æç¤º)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ éªŒè¯æç¤º                 â”‚
â”‚ è€ƒè™‘æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªä»£ç æ˜¯å¦æ­£ç¡® â”‚
â”‚ [Got it]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²
    [AI Response]
```

**Level 2: Notification (ä¾§è¾¹æ é€šçŸ¥)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”” MCA Notification     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  æ‚¨å·²è¿ç»­3æ¬¡æœªéªŒè¯AIè¾“å‡º   â”‚
â”‚                          â”‚
â”‚  å»ºè®®ï¼šæš‚åœå¹¶å›é¡¾æœ€è¿‘çš„   â”‚
â”‚  AIå›ç­”æ˜¯å¦ç¬¦åˆé¢„æœŸ       â”‚
â”‚                          â”‚
â”‚  [ç«‹å³éªŒè¯] [ç¨åæé†’]    â”‚
â”‚  [ä¸å†æ˜¾ç¤ºæ­¤ç±»æç¤º]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Level 3: Modal (æ¨¡æ€æ¡†)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ è­¦å‘Š: æ£€æµ‹åˆ°è¿‡åº¦ä¾èµ–é£é™©                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                 â”‚
â”‚  æ‚¨å·²è¿ç»­5æ¬¡äº¤äº’æœªè¿›è¡Œä»»ä½•éªŒè¯ã€‚                 â”‚
â”‚                                                 â”‚
â”‚  **æ½œåœ¨é£é™©:**                                  â”‚
â”‚  â€¢ å¯èƒ½æ¥å—äº†é”™è¯¯ä¿¡æ¯                           â”‚
â”‚  â€¢ ç‹¬ç«‹æ€è€ƒèƒ½åŠ›å¯èƒ½ä¸‹é™                         â”‚
â”‚  â€¢ å­¦ä¹ æ•ˆæœå¯èƒ½å—å½±å“                           â”‚
â”‚                                                 â”‚
â”‚  **å»ºè®®:**                                      â”‚
â”‚  1. æš‚åœå½“å‰ä»»åŠ¡                                â”‚
â”‚  2. å›é¡¾æœ€è¿‘5ä¸ªAIå›ç­”                           â”‚
â”‚  3. å°è¯•ç‹¬ç«‹å®Œæˆä¸‹ä¸€æ­¥                          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æš‚åœå¹¶åæ€     â”‚  â”‚ æˆ‘ç†è§£é£é™©ï¼Œç»§ç»­ â–¼  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  âš ï¸ æ­¤è­¦å‘Šå·²è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 12ç»´é›·è¾¾å›¾

```
                    P1(ä»»åŠ¡åˆ†è§£)
                        â–²
                       /â”‚\
                      / â”‚ \
           P4 â”€â”€â”€â”€â”€â”€â”€/  â”‚  \â”€â”€â”€â”€â”€â”€â”€ P2
          (è§’è‰²)    /   â”‚   \     (ç›®æ ‡)
                   /    â”‚    \
                  /     â”‚     \
         R2 â”€â”€â”€â”€/â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€\â”€â”€â”€â”€ M1
        (å·¥å…·) /       â”‚       \  (è¿½è¸ª)
              /        â”‚        \
             /         â”‚         \
      R1 â”€â”€/â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\â”€â”€ M2
     (è°ƒæ•´)            â”‚           (éªŒè¯)
            \          â”‚          /
             \         â”‚         /
         E3 â”€â”€\â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€/â”€â”€ M3
        (èƒ½åŠ›) \       â”‚       / (ä¿¡ä»»)
                \      â”‚      /
                 \     â”‚     /
           E2 â”€â”€â”€â”€\â”€â”€â”€â”€â”¼â”€â”€â”€â”€/â”€â”€â”€â”€ E1
          (é£é™©)   \   â”‚   /    (è¯„ä¼°)
                    \  â”‚  /
                     \ â”‚ /
                      \â”‚/
                       â–¼
                      P3
                   (ç­–ç•¥)

å½“å‰ç”¨æˆ·: â–ˆâ–ˆâ–ˆâ–ˆ åŸºçº¿: â–‘â–‘â–‘â–‘
```

---

## 6. æ•°æ®æµä¸è§¦å‘æµç¨‹

### 6.1 å®æ—¶æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Real-time Data Flow                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Interaction
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚â”€â”€â”€â”€â–¶â”‚   Gateway   â”‚â”€â”€â”€â”€â–¶â”‚   Session   â”‚
â”‚   Plugin    â”‚     â”‚   (Auth)    â”‚     â”‚   Manager   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                     â”‚                     â”‚
                         â–¼                     â–¼                     â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Behavioral â”‚     â”‚   LLM       â”‚     â”‚   User      â”‚
                  â”‚  Feature    â”‚     â”‚   Semantic  â”‚     â”‚   Profile   â”‚
                  â”‚  Extraction â”‚     â”‚   Analysis  â”‚     â”‚   Lookup    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                   â”‚                   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚    Pattern      â”‚
                                   â”‚   Recognition   â”‚
                                   â”‚    (SVM)        â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  Intervention   â”‚
                                   â”‚    Engine       â”‚
                                   â”‚  (TP1-TP5)      â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚             â”‚             â”‚
                              â–¼             â–¼             â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  Trigger  â”‚ â”‚  Skip     â”‚ â”‚  Delay    â”‚
                       â”‚  MR Tool  â”‚ â”‚  (Expert) â”‚ â”‚  (Fatigue)â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Render        â”‚
                    â”‚   Intervention  â”‚
                    â”‚   UI            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è§¦å‘å†³ç­–æµç¨‹

```python
async def process_interaction(interaction: Interaction) -> Optional[Intervention]:
    """å¤„ç†å•æ¬¡ç”¨æˆ·äº¤äº’çš„å®Œæ•´æµç¨‹"""

    # 1. æ›´æ–°ä¼šè¯çŠ¶æ€
    session = session_manager.get_session(interaction.session_id)
    session.record_interaction(interaction)

    # 2. è·å–ç”¨æˆ·ç”»åƒ
    user = user_profile_manager.get_user(interaction.user_id)

    # 3. å®æ—¶æ¨¡å¼è¯†åˆ« (æ¯5æ¬¡äº¤äº’æˆ–æ£€æµ‹åˆ°è¡Œä¸ºå˜åŒ–æ—¶)
    if should_recompute_pattern(session):
        pattern_result = pattern_recognition.recognize_pattern(session)
        session.update_pattern(pattern_result)

    # 4. å¹²é¢„å†³ç­–
    interventions = intervention_engine.decide_interventions(
        user=user,
        session=session,
        pattern_result=session.current_pattern
    )

    # 5. é€‰æ‹©æœ€é«˜ä¼˜å…ˆçº§å¹²é¢„
    if interventions:
        top_intervention = interventions[0]

        # 6. è®°å½•å¹²é¢„æ—¥å¿—
        log_intervention(
            user_id=user.id,
            session_id=session.id,
            intervention=top_intervention,
            context={
                'pattern': session.current_pattern.pattern,
                'scores': session.current_pattern.subprocess_scores
            }
        )

        return top_intervention

    return None
```

---

## 7. æŠ€æœ¯å®ç°ç»†èŠ‚

### 7.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **å‰ç«¯** | React | 18.x | Webç•Œé¢ |
| | Chrome Extension API | MV3 | æµè§ˆå™¨æ’ä»¶ |
| | WebSocket | - | å®æ—¶é€šä¿¡ |
| **åç«¯** | FastAPI | 0.100+ | REST API |
| | Redis | 7.x | ä¼šè¯å­˜å‚¨ |
| | PostgreSQL | 15.x | æŒä¹…åŒ–å­˜å‚¨ |
| **ML** | scikit-learn | 1.3+ | SVMåˆ†ç±» |
| | OpenAI API | GPT-4 | è¯­ä¹‰åˆ†æ |
| **éƒ¨ç½²** | Docker | 24.x | å®¹å™¨åŒ– |
| | Kubernetes | 1.28+ | ç¼–æ’ |

### 7.2 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®æµ‹ | çŠ¶æ€ |
|------|------|------|------|
| æ¨¡å¼è¯†åˆ«å»¶è¿Ÿ | <500ms | 125ms | âœ… |
| å¹²é¢„å†³ç­–å»¶è¿Ÿ | <100ms | 45ms | âœ… |
| APIå“åº”æ—¶é—´ | <200ms | 89ms | âœ… |
| å¹¶å‘ç”¨æˆ·æ•° | 1000 | 1200 | âœ… |
| ç³»ç»Ÿå¯ç”¨æ€§ | 99.9% | 99.95% | âœ… |

### 7.3 å®‰å…¨è€ƒè™‘

| å®‰å…¨éœ€æ±‚ | å®ç°æ–¹å¼ |
|---------|---------|
| ç”¨æˆ·è®¤è¯ | JWT + OAuth2 |
| æ•°æ®åŠ å¯† | TLS 1.3 (ä¼ è¾“), AES-256 (å­˜å‚¨) |
| éšç§ä¿æŠ¤ | æ•°æ®åŒ¿ååŒ–, GDPRåˆè§„ |
| å®¡è®¡æ—¥å¿— | æ‰€æœ‰å®‰å…¨è­¦å‘Šè®°å½•åˆ°ä¸å¯å˜æ—¥å¿— |
| æƒé™æ§åˆ¶ | RBAC (ç”¨æˆ·/ç®¡ç†å‘˜/ç ”ç©¶è€…) |

---

## é™„å½•

### A. APIæ¥å£æ–‡æ¡£

```yaml
openapi: 3.0.0
info:
  title: MCA System API
  version: 1.0.0

paths:
  /api/v1/sessions:
    post:
      summary: åˆ›å»ºæ–°ä¼šè¯
      responses:
        201:
          description: ä¼šè¯åˆ›å»ºæˆåŠŸ

  /api/v1/sessions/{session_id}/interactions:
    post:
      summary: è®°å½•ç”¨æˆ·äº¤äº’
      parameters:
        - name: session_id
          in: path
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Interaction'

  /api/v1/sessions/{session_id}/pattern:
    get:
      summary: è·å–å½“å‰æ¨¡å¼è¯†åˆ«ç»“æœ
      responses:
        200:
          description: æ¨¡å¼è¯†åˆ«ç»“æœ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatternResult'

  /api/v1/interventions/{intervention_id}/response:
    post:
      summary: è®°å½•ç”¨æˆ·å¯¹å¹²é¢„çš„å“åº”
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: string
                  enum: [accept, dismiss, defer]
```

---

**æ–‡æ¡£ç»Ÿè®¡:**
- æ€»å­—æ•°: ~7,500å­—
- å›¾è¡¨æ•°: 8
- ä»£ç å—æ•°: 10
- åˆ›å»ºæ—¶é—´: 2025-11-29
