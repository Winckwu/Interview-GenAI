# 对话分支系统测试指南

## ✅ 功能测试清单

### 1. 基础分支功能 (Branch Basics)

- [ ] **创建分支 (MR6)**
  1. 启动前后端服务
  2. 创建新对话
  3. 发送问题："解释量子计算"
  4. 等待AI回答
  5. 点击消息下方的 MR6 建议
  6. 选择不同的模型（GPT-4o, GPT-4o-mini等）
  7. 点击 "✓ Replace with This Answer"
  8. ✅ 验证：分支导航栏出现，显示 [MR6: gpt-4o (2/2)]

- [ ] **创建分支 (MR5)**
  1. 打开 MR5 Low-Cost Iteration 工具
  2. 设置温度范围：0.3-0.9
  3. 点击 "✨ Generate Variants"
  4. 等待生成3个变体
  5. 点击某个变体的 "✓ Use This Variant"
  6. ✅ 验证：分支创建，显示 [MR5: variant (2/2)]

### 2. 分支导航 (Navigation)

- [ ] **左右切换**
  1. 在有分支的消息上
  2. 点击 ◀ 按钮
  3. ✅ 验证：显示上一个分支内容
  4. 点击 ▶ 按钮
  5. ✅ 验证：显示下一个分支内容
  6. ✅ 验证：在第一个分支时 ◀ 灰色禁用
  7. ✅ 验证：在最后一个分支时 ▶ 灰色禁用

- [ ] **分支索引显示**
  1. ✅ 验证：显示 "Original (1/3)" 在原始回答
  2. ✅ 验证：显示 "MR6: gpt-4o (2/3)" 在MR6分支
  3. ✅ 验证：颜色：蓝色（原始），粉色（分支）

### 3. 分支历史 (History)

- [ ] **查看元数据**
  1. 悬停在 ℹ️ 图标上
  2. ✅ 验证：Tooltip显示：
     - Created: Dec 21, 10:30 AM
     - Source: MR6 或 MR5
     - Model: gpt-4o 等
     - ✓ Verified (如果已验证)
     - ✎ Modified (如果已修改)

### 4. 分支删除 (Deletion)

- [ ] **删除分支**
  1. 切换到一个分支（不是原始）
  2. 点击 🗑️ 按钮
  3. ✅ 验证：出现确认对话框
  4. 点击 "确定"
  5. ✅ 验证：分支被删除
  6. ✅ 验证：自动切换到上一个分支
  7. ✅ 验证：分支计数更新 (2/3 → 2/2)

- [ ] **不能删除原始**
  1. 切换到原始回答 (1/X)
  2. ✅ 验证：🗑️ 按钮不显示

### 5. 设为主回答 (Set as Main)

- [ ] **提升分支**
  1. 切换到一个分支
  2. 点击 "⭐ Set as Main" 按钮
  3. ✅ 验证：出现确认对话框
  4. 点击 "确定"
  5. ✅ 验证：分支内容成为主内容
  6. ✅ 验证：原始内容变成分支
  7. ✅ 验证：索引重置为 (1/3)

- [ ] **不能在原始上提升**
  1. 切换到原始回答
  2. ✅ 验证：⭐ 按钮不显示

### 6. 持久化 (Persistence)

- [ ] **刷新页面**
  1. 创建几个分支
  2. 刷新浏览器页面 (F5)
  3. ✅ 验证：所有分支依然存在
  4. ✅ 验证：可以正常导航
  5. ✅ 验证：元数据完整（时间、模型等）

- [ ] **跨会话**
  1. 创建分支
  2. 关闭浏览器
  3. 重新打开并登录
  4. 返回同一对话
  5. ✅ 验证：分支依然存在

### 7. 错误处理 (Error Handling)

- [ ] **网络错误**
  1. 停止后端服务
  2. 尝试创建分支
  3. ✅ 验证：显示错误消息
  4. ✅ 验证：UI不崩溃

- [ ] **并发操作**
  1. 快速点击多个操作
  2. ✅ 验证：不会产生重复分支
  3. ✅ 验证：操作按顺序完成

### 8. UI/UX (User Experience)

- [ ] **视觉反馈**
  1. ✅ 验证：按钮hover效果
  2. ✅ 验证：禁用按钮明显灰化
  3. ✅ 验证：成功消息显示3秒
  4. ✅ 验证：错误消息显示3秒

- [ ] **响应性**
  1. ✅ 验证：操作<500ms响应
  2. ✅ 验证：加载状态显示
  3. ✅ 验证：动画流畅

## 🐛 已知问题检查

### 检查点1：数据库连接
```bash
# 测试数据库是否可访问
psql interview_genai -c "SELECT COUNT(*) FROM message_branches;"
```

### 检查点2：后端API
```bash
# 测试API端点
curl http://localhost:5001/api/branches/interaction/test-id
```

### 检查点3：前端构建
```bash
cd frontend
npm run build
# 检查是否有TypeScript错误
```

## 📊 性能测试

- [ ] **大量分支**
  1. 创建10+个分支
  2. ✅ 验证：导航依然流畅
  3. ✅ 验证：UI不卡顿

- [ ] **长内容分支**
  1. 创建包含长回答的分支
  2. ✅ 验证：渲染正常
  3. ✅ 验证：滚动流畅

## 🔒 安全测试

- [ ] **权限检查**
  1. 创建分支
  2. 登出并用另一账户登录
  3. ✅ 验证：看不到其他用户的分支

- [ ] **SQL注入**
  1. 尝试在分支内容中使用SQL语句
  2. ✅ 验证：内容被正确转义

## 📝 测试报告模板

```
日期：____
测试人员：____

✅ 通过功能：
- [ ] 分支创建
- [ ] 分支导航
- [ ] 分支删除
- [ ] 设为主回答
- [ ] 持久化
- [ ] 历史显示

❌ 失败功能：
-

🐛 发现的Bug：
1.
2.

💡 改进建议：
1.
2.
```

## 🚀 快速测试脚本

```bash
#!/bin/bash
# 快速测试流程

echo "1. 启动后端..."
cd backend && npm run dev &

echo "2. 启动前端..."
cd frontend && npm run dev &

echo "3. 等待服务启动..."
sleep 5

echo "4. 打开浏览器"
open http://localhost:3000

echo "✅ 测试环境已就绪！"
echo "请按照 TESTING_GUIDE.md 中的清单进行测试"
```

## 📞 问题报告

如果发现问题，请提供：
1. 复现步骤
2. 预期行为
3. 实际行为
4. 浏览器/环境信息
5. 截图或录屏
